#!/bin/sh
# Unified shell configuration file for bash and zsh.
# Written by ayekat on a warm summer day in 2013.


# ------------------------------------------------------------------------------
# SYSTEM {{{

# Read operating system information (if available):
if [ -e /etc/os-release ]; then
	arch="$(grep -e '^ID=' /etc/os-release | cut -c 4-)"
elif [ "$(uname)" = 'Darwin' ]; then
	arch='darwin'
elif [ -e /etc/gentoo-release ]; then
	arch='gentoo'
else
	arch='unknown'
fi

# Determine if desktop (Xorg exists or OS X):
[ -e /usr/bin/xinit -o "$arch" = 'darwin' ] && IS_DESKTOP=1

# If not, we are on a server, so start or reattach to tmux session if SSH:
if [ ! $IS_DESKTOP ] && [ ! -z "$SSH_TTY" ]; then
	[ -e /usr/bin/tmux ] && [ "$TERM" != 'screen-256color' ] && tmx 0 && exit
fi

# }}}
# ------------------------------------------------------------------------------
# ALIASES {{{

alias cp='cp -i'
alias grep='grep --color=auto'
alias info='info --vi-keys'
alias la='ls -A'
alias lah='ls -lAh'
alias laht='ls -lAht'
alias ll='ls -lh'
alias mk='ayemake'
alias mv='mv -i'
alias sudo='sudo -p "[sudo]"\ password:\ '
# BSD vs GNU:
[ "$arch" = 'darwin' ] && alias ls='ls -G' || alias ls='ls --color=auto'

# Coloured man pages:
man() {
	if [ "$TERM" = 'linux' ]; then
		env \
			LESS_TERMCAP_mb=$(printf "\e[34m") \
			LESS_TERMCAP_md=$(printf "\e[1;31m") \
			LESS_TERMCAP_me=$(printf "\e[0m") \
			LESS_TERMCAP_se=$(printf "\e[0m") \
			LESS_TERMCAP_so=$(printf "\e[30;43m") \
			LESS_TERMCAP_ue=$(printf "\e[0m") \
			LESS_TERMCAP_us=$(printf "\e[32m") \
					/usr/bin/man "$@"
	else
		env \
			LESS_TERMCAP_mb=$(printf "\e[1;34m") \
			LESS_TERMCAP_md=$(printf "\e[38;5;9m") \
			LESS_TERMCAP_me=$(printf "\e[0m") \
			LESS_TERMCAP_se=$(printf "\e[0m") \
			LESS_TERMCAP_so=$(printf "\e[30;43m") \
			LESS_TERMCAP_ue=$(printf "\e[0m") \
			LESS_TERMCAP_us=$(printf "\e[38;5;10m") \
					/usr/bin/man "$@"
	fi
}

# Server only aliases (mostly additional security):
[ ! $IS_DESKTOP ] && alias rm='rm -i'

# Application specific aliases:
[ -e /usr/bin/thunar ] && alias open='thunar'
[ -e /usr/bin/valgrind ] && alias valgrind='valgrind --log-file=valgrind.log'

# }}}
# ------------------------------------------------------------------------------
# SHORTCUTS {{{

# if the folder does not exist, cd will try in $CDPATH before failing:
case "$HOSTNAME" in
	ixh) CDPATH=".:/nas/himbeeri/public" ;;
#	penrose) CDPATH=".:~/db/project" ;;
esac

# }}}
# ------------------------------------------------------------------------------
# START-UP ACTIONS {{{

# Define logos:
printlogo() {
	case "$1" in
		debian)
			printf "\e[31m                             \n"
			printf       "          .xd§PVkbxc.        \n"
			printf       "         xP*'      'Vb.      \n"
			printf       "       'd'     .,.   V.'     \n"
			printf       "       (*    .'   .  ::      \e[0m `uname -s -r`\n"
			printf "\e[31m       #     #      ,7       \e[0m on `uname -n`\n"
			printf "\e[31m       V,     *-__ -'        \n"
			printf       "       'qb                   \n"
			printf       "         *:,                 \n"
			printf       "           '-.               \n"
			printf       "               '             \n"
			printf  "\e[0m                             \n"
			;;
		arch)
			printf "\e[34m                             \n"
			printf       "              /\\             \n"
			printf       "             /AA\\            \n"
			printf       "            .'YAA\\           \n"
			printf       "           /AAAAAA\\          \e[0m `uname -s -r`\n"
			printf "\e[34m          /AAAAAAAA\\         \e[0m on `uname -n`\n"
			printf "\e[34m         /AAA/  \\AAA\\        \n"
			printf       "        /AAA|    |AAP\\       \n"
			printf       "       /AAAY\\    /YAAa_      \n"
			printf       "      />*'          '*<\\     \n"
			printf       "     ^                  ^    \n"
			printf  "\e[0m                             \n"
			;;
		darwin)
			printf "\e[32m                  .          \n"
			printf       "               .dA'          \n"
			printf       "               AP'           \n"
			printf       "        .dAAbx.,dAAAb.       \n"
			printf "\e[33m       dAAAAAAAAAAAAP        \e[0m `uname -s -r`\n"
			printf "\e[31m      :AAAAAAAAAAAAA         \e[0m on `uname -n`\n"
			printf "\e[31m      'AAAAAAAAAAAAA.        \n"
			printf "\e[35m       YAAAAAAAAAAAAAx.      \n"
			printf "\e[34m        \\AAAAAAAAAAAAP       \n"
			printf "\e[36m         '<AV*''*\\AP'        \n"
			printf       "                             \n"
			printf "\e[0m                              \n"
			;;
		gentoo)
			printf "\e[36m           __                \n"
			printf       "       .-d§§§§§bc,           \n"
			printf       "      /§§§§§*\"*Y§§§c.       \n"
			printf       "     (§§§§§§.   )§§§§b,      \n"
			printf       "     '(§§§§§§bxxI§§§§§§b     \e[0m `uname -s -r`\n"
			printf "\e[36m       \`\">§§§§§§§§§§§§§§)    \e[0m on `uname -n`\n"
			printf "\e[36m       .?§§§§§§§§§§§§§P\`    \n"
			printf       "     .A§§§§§§§§§§§§§*'       \n"
			printf       "     §§§§§§§§§§§\$*\`        \n"
			printf       "     V§§§§§§§*'\`            \n"
			printf       "       \`\"\`\`              \n"
			printf  "\e[0m                             \n"
			;;
	esac
}

# Print system logo:
printlogo "$arch"

# Display the todo file in the home directory:
[ -e "$HOME"/TODO ] && { echo; cat "$HOME"/TODO; echo; }

# }}}
