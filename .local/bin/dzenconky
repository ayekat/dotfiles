#!/bin/bash
# displays conky in dzen2

dzenconky_start() {
	# Check for changes in .Xresources (needed by dzen2):
	xrdb ~/.Xresources 

	# Calculate dzen2 position and placement:
	screenwidth=$(xrandr | grep '*' | head -n 1 | cut -c 4-7)
	numtags=9
	charwidth=6
	tagwidth=$(($numtags*(3*$charwidth+1) + 5*$charwidth))
	dzenwidth=$(($screenwidth-$tagwidth))

	# Draw according conky|dzen2 on each monitor (if .conkyrc is available):
	for ((i=1; i<=$NUMSCREENS; i++)); do
		conkyrc=$(printf "%s/conky/%s_%d.conkyrc" \
				$XDG_CONFIG_HOME $HOSTNAME $i)
		dzenpos=$(($tagwidth + $(($i-1))*$screenwidth))
		if [[ -e $conkyrc ]]; then
			conky -c $conkyrc | dzen2 -w $dzenwidth -h 15 -x $dzenpos -ta r &
		fi
	done

	# Draw conky instance that displays time:
	#conkyrc=$(printf "%s/conky/%s_time.conkyrc" $XDG_CONFIG_HOME $HOSTNAME)
	#conky -c $conkyrc &
}

dzenconky_stop() {
	killall dzen2
	killall conky
}

dzenconky_help() {
	printf "dzenconky  \e[1mstart\e[0m|\e[1mstop\e[0m|\e[1mrestart\e[0m\n"
}

case $1 in
	start)
		dzenconky_start &
		;;
	stop)
		dzenconky_stop
		;;
	restart)
		dzenconky_stop
		dzenconky_start &
		;;
	*)
		dzenconky_help
esac

