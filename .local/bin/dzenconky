#!/bin/bash
# displays conky in dzen2

sum()
{
	sum=0
	array=($@)
	for ((i=0; i<$#; i++)); do
		sum=$(($sum+${array[$i]}))
	done
	echo $sum
}

dzenconky_start() {
	# Check for changes in .Xresources (needed by dzen2):
	xrdb ~/.Xresources

	# Calculate position of dzen2 and draw on each monitor
	# (if .conkyrc is available):
	numscreens=$(xrandr | grep '*' | wc -l)
	screenwidth=($(xrandr | grep '*' | cut -c 4-7))
	tagwidth=219
	for ((i=0; i<$numscreens; i++)); do
		dzenwidth=$((${screenwidth[$i]}-$tagwidth))
		conkyrc=$(printf "%s/conky/%s_%d.conkyrc" \
				$XDG_CONFIG_HOME $HOSTNAME $i)
		dzenpos=$(sum ${screenwidth[@]:0:$i})
		dzenpos=$(($tagwidth+$dzenpos))
		if [[ -e $conkyrc ]]; then
			conky -c $conkyrc | dzen2 -w $dzenwidth -h 15 -x $dzenpos -ta r &
		fi
	done
}

dzenconky_stop() {
	killall dzen2
	killall conky
}

dzenconky_help() {
	printf "dzenconky  \e[1mstart\e[0m | \e[1mstop\e[0m | \e[1mrestart\e[0m\n"
}

case $1 in
	start)
		dzenconky_start
		;;
	stop)
		dzenconky_stop
		;;
	restart)
		dzenconky_stop
		dzenconky_start
		;;
	*)
		dzenconky_help
esac

