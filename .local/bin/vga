#!/bin/sh
# Script for simplifying on-the-go addition of a VGA-monitor to my laptop.
# Written by ayekat on a boring january day; improved in october 2013.

vganame='VGA1'
lcdname='LVDS1'
appname="$(basename "$0")"

vga_add() {
	# mode:
	modeline="$(xrandr | grep -A 1 "$vganame connected" | tail -n +2)"
	if [ -z "$modeline" ]; then
		printf "[%s] %s is not connected\n" "$appname" "$vganame"
		exit 1
	fi

	# position:
	position="$1"
	case "$position" in
		right|left) position="${position}-of";;
	esac
	xrandr --output "$lcdname" --auto || exit 1
	xrandr --output "$vganame" --auto --${position} "$lcdname" || exit 1

	# variables:
	dynenv NUM_SCREENS=2
	vga_setup
}

vga_remove() {
	printf "[%s] %s: removing %s...\n" "$(date +%H:%M:%S)" "$appname" "$vganame"
	xrandr --output "$vganame" --off || exit 1
	dynenv NUM_SCREENS=1
	vga_setup
}

vga_setup() {
	xrandr --output LVDS --dpi 96
	dzenstat restart
	nitrogen --restore
}

vga_help() {
	printf "%s add (right|left|above|below)|remove\n" "$appname"
}

command="$1"
shift

case "$command" in
	add)
		[ $# -ne 1 ] && { vga_help; exit 1; }
		vga_add "$@";;

	remove)
		vga_remove;;

	*)
		vga_help
esac

